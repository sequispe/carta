<script>
fetch("teleprompter.json")
  .then(r => r.json())
  .then(cfg => {
    if (!cfg.activo) return;
    if (!cfg.mensajes || cfg.mensajes.length === 0) return;

    const tele = document.getElementById("teleprompter");
    const text = document.getElementById("tele-text");

    tele.classList.remove("oculto");

    let index = 0;
    const velocidad = cfg.velocidad || 22;

    function iniciarMensaje(){
      text.textContent = cfg.mensajes[index];

      // esperar a que el navegador calcule el ancho
      requestAnimationFrame(() => {
        const anchoTexto = text.offsetWidth;
        const anchoPantalla = window.innerWidth;

        let x = anchoPantalla;

        function mover(){
          x -= velocidad / 10;
          text.style.transform = `translateX(${x}px)`;

          if (x < -anchoTexto){
            index = (index + 1) % cfg.mensajes.length;
            iniciarMensaje(); // ðŸ” siguiente mensaje
            return;
          }
          requestAnimationFrame(mover);
        }

        mover();
      });
    }

    iniciarMensaje();
  })
  .catch(err => console.error("Teleprompter error", err));
</script>
